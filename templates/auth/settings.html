{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/settings.css' %}">
{% endblock %}

{% block title %}Settings{% endblock %}

{% block content %}
<div class="settings-container">
    <h2>Account Settings</h2>
    <div class="settings-actions">
        <button id="showEditProfile" class="btn btn-info settings-toggle">Edit Profile</button>
        <button id="showChangePassword" class="btn btn-info settings-toggle">Change Password</button>
        <button id="showComplaint" class="btn btn-info settings-toggle">Complaint/Message</button>
        <button id="showDeleteAccount" class="btn btn-danger settings-toggle">Delete Account</button>
    </div>

    <hr>

    <div id="editProfileForm" class="settings-form" style="display:none;">
        <h4>Edit Profile</h4>
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            {{ profile_form.as_p }}
            <button type="submit" name="edit_profile" class="btn btn-info">Update Profile</button>
        </form>
    </div>

    <div id="changePasswordForm" class="settings-form" style="display:none;">
        <h4>Change Password</h4>
        <form method="post">
            {% csrf_token %}
            {{ password_form.as_p }}
            <button type="submit" name="change_password" class="btn btn-info">Change Password</button>
        </form>
    </div>

    <div id="complaintForm" class="settings-form" style="display:none;">
        <h4>Send Complaint/Message</h4>
        <form method="post" >
            {% csrf_token %}
            <div class="form-group">
                <label for="subject">Subject:</label>
                <input id="subject" name="subject" type="text" class="form-control">
            </div>
            <div class="form-group">
                <label for="message">Message:</label>
                <textarea id="message" name="message" rows="4" class="form-control"></textarea>
            </div>
            <button type="submit" name="send_message" class="btn btn-info">Send Message</button>
            <b>send manual email to <a href="mailto:photobuddy001@gmail.com">photobuddy001@gmail.com</a> if you can't send here with your registered email id. </b>
        </form>
    </div>

    <div id="deleteAccountForm" class="settings-form" style="display:none;">
        <h4>Danger Zone</h4>
        <form method="post" onsubmit="return confirm('Are you sure you want to delete your account? This cannot be undone!');">
            {% csrf_token %}
            <button type="submit" name="delete_account" class="btn btn-danger">Delete Account</button>
        </form>
    </div>

    {% if messages %}
        <ul class="messages">
        {% for msg in messages %}
            <li>{{ msg }}</li>
        {% endfor %}
        </ul>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const forms = ['editProfileForm', 'changePasswordForm', 'complaintForm', 'deleteAccountForm'];
    function showForm(formId) {
        forms.forEach(id =>
            document.getElementById(id).style.display = (id === formId ? 'block' : 'none')
        );
    }
    document.getElementById('showEditProfile').onclick = () => showForm('editProfileForm');
    document.getElementById('showChangePassword').onclick = () => showForm('changePasswordForm');
    document.getElementById('showComplaint').onclick = () => showForm('complaintForm');
    document.getElementById('showDeleteAccount').onclick = () => showForm('deleteAccountForm');
    // Optionally show edit profile as default:
    showForm('editProfileForm');
});
</script>
{% endblock %}
